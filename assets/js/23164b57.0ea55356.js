"use strict";(self.webpackChunkrahat_documentation=self.webpackChunkrahat_documentation||[]).push([[7301],{28453:(e,n,a)=>{a.d(n,{R:()=>s,x:()=>o});var t=a(96540);const r={},i=t.createContext(r);function s(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),t.createElement(i.Provider,{value:n},e.children)}},88364:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>p,frontMatter:()=>s,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"Project-Modules/Anticipatory-Action/Payout-Services","title":"Financial Payout Services","description":"This document provides detailed information about the financial payout services integrated into the Rahat Anticipatory Action platform, including offramp services, payment providers, and token-to-fiat conversion workflows.","source":"@site/dev-docs/Project-Modules/01.Anticipatory-Action/04.Payout-Services.md","sourceDirName":"Project-Modules/01.Anticipatory-Action","slug":"/Project-Modules/Anticipatory-Action/Payout-Services","permalink":"/dev-docs/Project-Modules/Anticipatory-Action/Payout-Services","draft":false,"unlisted":false,"editUrl":"https://github.com/rahataid/rahat-documentation/blob/dev/dev-docs/Project-Modules/01.Anticipatory-Action/04.Payout-Services.md","tags":[],"version":"current","lastUpdatedAt":1754021596000,"sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"Financial Payout Services"},"sidebar":"myAutogeneratedSidebar","previous":{"title":"Forecast Data Sources","permalink":"/dev-docs/Project-Modules/Anticipatory-Action/Forecast-Data-Sources"},"next":{"title":"Communication Services","permalink":"/dev-docs/Project-Modules/Anticipatory-Action/Comunication-Services"}}');var r=a(74848),i=a(28453);const s={sidebar_position:4,title:"Financial Payout Services"},o="Financial Payout Services",c={},l=[{value:"Overview",id:"overview",level:2},{value:"Architecture",id:"architecture",level:2},{value:"Core Components",id:"core-components",level:3},{value:"1. Offramp Services",id:"1-offramp-services",level:4},{value:"2. Payment Providers",id:"2-payment-providers",level:4},{value:"3. Payout Management",id:"3-payout-management",level:4},{value:"Payout Flow",id:"payout-flow",level:2},{value:"1. Payout Initiation",id:"1-payout-initiation",level:3},{value:"Payout Service Structure",id:"payout-service-structure",level:4},{value:"Beneficiary Payout Details",id:"beneficiary-payout-details",level:4},{value:"2. Token Transfer Process",id:"2-token-transfer-process",level:3},{value:"Stellar Token Transfer",id:"stellar-token-transfer",level:4},{value:"3. Offramp Processing",id:"3-offramp-processing",level:3},{value:"Offramp Service Integration",id:"offramp-service-integration",level:4},{value:"Offramp Payload Generation",id:"offramp-payload-generation",level:4},{value:"4. Payment Provider Integration",id:"4-payment-provider-integration",level:3},{value:"Payment Provider Types",id:"payment-provider-types",level:4},{value:"Payment Provider API",id:"payment-provider-api",level:4},{value:"Status Tracking",id:"status-tracking",level:2},{value:"Payout Status",id:"payout-status",level:3},{value:"Beneficiary Redeem Status",id:"beneficiary-redeem-status",level:3},{value:"Monitoring and Analytics",id:"monitoring-and-analytics",level:2},{value:"Payout Metrics",id:"payout-metrics",level:3},{value:"Transaction Tracking",id:"transaction-tracking",level:3},{value:"Configuration Management",id:"configuration-management",level:2},{value:"Settings Management",id:"settings-management",level:3}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"financial-payout-services",children:"Financial Payout Services"})}),"\n",(0,r.jsx)(n.p,{children:"This document provides detailed information about the financial payout services integrated into the Rahat Anticipatory Action platform, including offramp services, payment providers, and token-to-fiat conversion workflows."}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(n.p,{children:"The financial payout system enables the conversion of blockchain tokens to local currency and distribution to beneficiaries through various payment methods. The system supports multiple payment providers and offramp services for seamless cash distribution."}),"\n",(0,r.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,r.jsx)(n.h3,{id:"core-components",children:"Core Components"}),"\n",(0,r.jsx)(n.h4,{id:"1-offramp-services",children:"1. Offramp Services"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Purpose"}),": Token-to-fiat conversion and local payment processing"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Integration"}),": REST API with authentication"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Features"}),": Instant conversion, bank transfers, VPA payments"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"2-payment-providers",children:"2. Payment Providers"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Purpose"}),": Local financial service provider integration"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Features"}),": Multiple provider support, transaction tracking"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Methods"}),": Bank transfers, mobile money, VPA"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"3-payout-management",children:"3. Payout Management"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Purpose"}),": Orchestrate the entire payout process"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Features"}),": Batch processing, status tracking, error handling"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"payout-flow",children:"Payout Flow"}),"\n",(0,r.jsx)(n.h3,{id:"1-payout-initiation",children:"1. Payout Initiation"}),"\n",(0,r.jsx)(n.h4,{id:"payout-service-structure",children:"Payout Service Structure"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// apps/aa/src/payouts/payouts.service.ts\n@Injectable()\nexport class PayoutsService {\n  constructor(\n    private readonly offrampService: OfframpService,\n    private readonly stellarService: StellarService,\n    private readonly prisma: PrismaService\n  ) {}\n\n  async triggerPayout(uuid: string): Promise<any> {\n    const payoutDetails = await this.findOne(uuid);\n    \n    if (payoutDetails.isPayoutTriggered) {\n      throw new RpcException(\n        `Payout with UUID '${uuid}' has already been triggered`\n      );\n    }\n\n    const BeneficiaryPayoutDetails = await this.fetchBeneficiaryPayoutDetails(uuid);\n    const offrampWalletAddress = await this.offrampService.getOfframpWalletAddress();\n\n    const stellerOfframpQueuePayload: FSPPayoutDetails[] = \n      BeneficiaryPayoutDetails.map((beneficiary) => ({\n        amount: beneficiary.amount,\n        beneficiaryWalletAddress: beneficiary.walletAddress,\n        beneficiaryBankDetails: beneficiary.bankDetails,\n        payoutUUID: uuid,\n        payoutProcessorId: payoutDetails.payoutProcessorId,\n        beneficiaryPhoneNumber: beneficiary.phoneNumber,\n        offrampWalletAddress,\n        offrampType: payoutExtras.paymentProviderType,\n      }));\n\n    await this.stellarService.addBulkToTokenTransferQueue(\n      stellerOfframpQueuePayload\n    );\n\n    return 'Payout Initiated Successfully';\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"beneficiary-payout-details",children:"Beneficiary Payout Details"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"interface BeneficiaryPayoutDetails {\n  amount: number;\n  walletAddress: string;\n  bankDetails: {\n    bankName: string;\n    accountNumber: string;\n    accountName: string;\n    ifscCode?: string;\n  };\n  phoneNumber: string;\n  beneficiaryId: string;\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-token-transfer-process",children:"2. Token Transfer Process"}),"\n",(0,r.jsx)(n.h4,{id:"stellar-token-transfer",children:"Stellar Token Transfer"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// apps/aa/src/processors/stellar.processor.ts\n@Processor(BQUEUE.STELLAR)\nexport class StellarProcessor {\n  @Process(JOBS.STELLAR.TRANSFER_TO_OFFRAMP)\n  async processTransferToOfframp(job: Job) {\n    const payload: FSPPayoutDetails = job.data;\n    \n    try {\n      // Transfer tokens from beneficiary to offramp wallet\n      const transactionResult = await this.stellarService.transferTokens({\n        fromAddress: payload.beneficiaryWalletAddress,\n        toAddress: payload.offrampWalletAddress,\n        amount: payload.amount,\n        assetCode: 'RAHAT',\n        assetIssuer: process.env.STELLAR_ASSET_ISSUER\n      });\n\n      // Add to offramp queue for cash conversion\n      await this.offrampService.addBulkToOfframpQueue([payload]);\n\n      return transactionResult;\n    } catch (error) {\n      this.logger.error(`Token transfer failed: ${error.message}`);\n      throw error;\n    }\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-offramp-processing",children:"3. Offramp Processing"}),"\n",(0,r.jsx)(n.h4,{id:"offramp-service-integration",children:"Offramp Service Integration"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// apps/aa/src/payouts/offramp.service.ts\n@Injectable()\nexport class OfframpService {\n  async fetchOfframpSettings(): Promise<{\n    url: string;\n    appId: string;\n    accessToken: string;\n  }> {\n    // Fetch settings from core service\n    const settings = await this.coreClient.send({\n      cmd: 'SETTINGS.GET',\n      data: { name: 'OFFRAMP_SETTINGS' }\n    });\n\n    return {\n      url: settings.value.URL,\n      appId: settings.value.APP_ID,\n      accessToken: settings.value.ACCESS_TOKEN\n    };\n  }\n\n  async getOfframpWalletAddress(): Promise<string> {\n    const offrampSettings = await this.fetchOfframpSettings();\n    \n    const response = await this.httpService.axiosRef.get(\n      `${offrampSettings.url}/app/${offrampSettings.appId}`,\n      {\n        headers: { 'APP_ID': offrampSettings.appId }\n      }\n    );\n\n    return response.data.data.wallet;\n  }\n\n  async instantOfframp(offrampPayload: any): Promise<CipsResponseData> {\n    const offrampSettings = await this.fetchOfframpSettings();\n    \n    const response = await this.httpService.axiosRef.post(\n      `${offrampSettings.url}/offramp-request/instant`,\n      offrampPayload,\n      {\n        headers: { 'APP_ID': offrampSettings.appId }\n      }\n    );\n\n    return response.data.data;\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"offramp-payload-generation",children:"Offramp Payload Generation"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// apps/aa/src/processors/offramp.processor.ts\nprivate async generateOfframpPayload(\n  offrampType: string,\n  fspOfframpDetails: FSPOfframpDetails\n): Promise<any> {\n  let offrampRequest: any = {\n    tokenAmount: fspOfframpDetails.amount,\n    paymentProviderId: fspOfframpDetails.payoutProcessorId,\n    transactionHash: fspOfframpDetails.transactionHash,\n    senderAddress: fspOfframpDetails.beneficiaryWalletAddress,\n    xref: fspOfframpDetails.payoutUUID,\n    paymentDetails: {\n      creditorAgent: getBankId(fspOfframpDetails.beneficiaryBankDetails.bankName),\n      creditorAccount: fspOfframpDetails.beneficiaryBankDetails.accountNumber,\n      creditorName: fspOfframpDetails.beneficiaryBankDetails.accountName,\n    },\n  };\n\n  if (offrampType.toLowerCase() === 'vpa') {\n    offrampRequest.paymentDetails = {\n      vpa: fspOfframpDetails.beneficiaryPhoneNumber,\n    };\n  }\n\n  return offrampRequest;\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"4-payment-provider-integration",children:"4. Payment Provider Integration"}),"\n",(0,r.jsx)(n.h4,{id:"payment-provider-types",children:"Payment Provider Types"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"interface IPaymentProvider {\n  id: string;\n  name: string;\n  type: 'BANK' | 'MOBILE_MONEY' | 'VPA' | 'CASH';\n  country: string;\n  currency: string;\n  supportedMethods: string[];\n  processingTime: string;\n  fees: {\n    percentage: number;\n    fixed: number;\n  };\n}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"payment-provider-api",children:"Payment Provider API"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"async getPaymentProvider(): Promise<IPaymentProvider[]> {\n  const offrampSettings = await this.fetchOfframpSettings();\n  \n  const response = await this.httpService.axiosRef.get(\n    `${offrampSettings.url}/payment-providers`,\n    {\n      headers: { 'APP_ID': offrampSettings.appId }\n    }\n  );\n\n  return response.data.data;\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"status-tracking",children:"Status Tracking"}),"\n",(0,r.jsx)(n.h3,{id:"payout-status",children:"Payout Status"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"enum PayoutStatus {\n  PENDING = 'PENDING',\n  PROCESSING = 'PROCESSING',\n  COMPLETED = 'COMPLETED',\n  FAILED = 'FAILED',\n  CANCELLED = 'CANCELLED'\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"beneficiary-redeem-status",children:"Beneficiary Redeem Status"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"interface BeneficiaryRedeem {\n  uuid: string;\n  beneficiaryId: string;\n  payoutUUID: string;\n  amount: number;\n  status: PayoutStatus;\n  transactionHash?: string;\n  offrampResponse?: any;\n  errorMessage?: string;\n  numberOfAttempts: number;\n  createdAt: Date;\n  updatedAt: Date;\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"monitoring-and-analytics",children:"Monitoring and Analytics"}),"\n",(0,r.jsx)(n.h3,{id:"payout-metrics",children:"Payout Metrics"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"interface PayoutMetrics {\n  totalPayouts: number;\n  totalAmount: number;\n  successfulPayouts: number;\n  failedPayouts: number;\n  averageProcessingTime: number;\n  successRate: number;\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"transaction-tracking",children:"Transaction Tracking"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"async getPayoutDetails(uuid: string) {\n  return {\n    payout: await this.prisma.payouts.findUnique({ where: { uuid } }),\n    beneficiaryRedeems: await this.prisma.beneficiaryRedeem.findMany({\n      where: { payoutUUID: uuid }\n    }),\n    transactionHistory: await this.getTransactionHistory(uuid)\n  };\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"configuration-management",children:"Configuration Management"}),"\n",(0,r.jsx)(n.h3,{id:"settings-management",children:"Settings Management"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// Offramp settings stored in database\ninterface OfframpSettings {\n  URL: string;\n  APP_ID: string;\n  ACCESS_TOKEN: string;\n  DEFAULT_PAYMENT_PROVIDER: string;\n  TRANSACTION_LIMITS: {\n    MIN_AMOUNT: number;\n    MAX_AMOUNT: number;\n    DAILY_LIMIT: number;\n  };\n}\n"})})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);