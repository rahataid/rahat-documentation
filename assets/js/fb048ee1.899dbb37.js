"use strict";(self.webpackChunkrahat_documentation=self.webpackChunkrahat_documentation||[]).push([[6712],{21456:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"Core-Modules/Beneficiary-Management","title":"Beneficiary Management","description":"Overview","source":"@site/dev-docs/Core-Modules/02.Beneficiary-Management.md","sourceDirName":"Core-Modules","slug":"/Core-Modules/Beneficiary-Management","permalink":"/dev-docs/Core-Modules/Beneficiary-Management","draft":false,"unlisted":false,"editUrl":"https://github.com/rahataid/rahat-documentation/blob/dev/dev-docs/Core-Modules/02.Beneficiary-Management.md","tags":[],"version":"current","lastUpdatedAt":1754478291000,"sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"Beneficiary Management"},"sidebar":"myAutogeneratedSidebar","previous":{"title":"Installation","permalink":"/dev-docs/Core-Modules/Installation"},"next":{"title":"Custodial Wallet Service","permalink":"/dev-docs/Core-Modules/Custodial-Wallet-Service"}}');var s=i(74848),r=i(28453);const t={sidebar_position:3,title:"Beneficiary Management"},c="Beneficiary Management Microservice",l={},d=[{value:"Overview",id:"overview",level:2},{value:"Architecture",id:"architecture",level:2},{value:"Service Type",id:"service-type",level:3},{value:"Key Components",id:"key-components",level:3},{value:"1. Main Application (<code>main.ts</code>)",id:"1-main-application-maints",level:4},{value:"2. Core Modules",id:"2-core-modules",level:4},{value:"CRUD Operations",id:"crud-operations",level:2},{value:"1. Create Operations",id:"1-create-operations",level:3},{value:"Single Beneficiary Creation",id:"single-beneficiary-creation",level:4},{value:"Bulk Beneficiary Creation",id:"bulk-beneficiary-creation",level:4},{value:"2. Read Operations",id:"2-read-operations",level:3},{value:"Individual Beneficiary Retrieval",id:"individual-beneficiary-retrieval",level:4},{value:"Bulk Beneficiary Retrieval",id:"bulk-beneficiary-retrieval",level:4},{value:"Listing and Filtering",id:"listing-and-filtering",level:4},{value:"3. Update Operations",id:"3-update-operations",level:3},{value:"Beneficiary Updates",id:"beneficiary-updates",level:4},{value:"Group Updates",id:"group-updates",level:4},{value:"4. Delete Operations",id:"4-delete-operations",level:3},{value:"Beneficiary Deletion",id:"beneficiary-deletion",level:4},{value:"Group Deletion",id:"group-deletion",level:4},{value:"Project Management",id:"project-management",level:2},{value:"Adding Beneficiaries to Projects",id:"adding-beneficiaries-to-projects",level:3},{value:"Group Management",id:"group-management",level:3},{value:"Verification and Security",id:"verification-and-security",level:2},{value:"Wallet Validation",id:"wallet-validation",level:3},{value:"Link Generation",id:"link-generation",level:3},{value:"Statistics and Analytics",id:"statistics-and-analytics",level:2},{value:"General Statistics",id:"general-statistics",level:3},{value:"Project-Specific Statistics",id:"project-specific-statistics",level:3},{value:"Import and Export Features",id:"import-and-export-features",level:2},{value:"Temporary Beneficiary Management",id:"temporary-beneficiary-management",level:3},{value:"Community Tool Integration",id:"community-tool-integration",level:3},{value:"Background Processing",id:"background-processing",level:2},{value:"Queue Management",id:"queue-management",level:3},{value:"Processors",id:"processors",level:3},{value:"Consumers",id:"consumers",level:3},{value:"Data Models",id:"data-models",level:2},{value:"Core Entities",id:"core-entities",level:3},{value:"PII Handling",id:"pii-handling",level:3},{value:"PII Data Considerations",id:"pii-data-considerations",level:2},{value:"PII Data Architecture",id:"pii-data-architecture",level:3},{value:"Data Separation Strategy",id:"data-separation-strategy",level:4},{value:"PII Data Processing Utilities",id:"pii-data-processing-utilities",level:4},{value:"PII Data Security Measures",id:"pii-data-security-measures",level:3},{value:"1. Encryption at Rest",id:"1-encryption-at-rest",level:4},{value:"2. Data Access Controls",id:"2-data-access-controls",level:4},{value:"3. Data Minimization",id:"3-data-minimization",level:4},{value:"PII Data Operations",id:"pii-data-operations",level:3},{value:"1. PII-Specific CRUD Operations",id:"1-pii-specific-crud-operations",level:4},{value:"2. PII Data Validation",id:"2-pii-data-validation",level:4},{value:"PII Data Compliance",id:"pii-data-compliance",level:3},{value:"1. GDPR Compliance",id:"1-gdpr-compliance",level:4},{value:"2. Data Privacy Controls",id:"2-data-privacy-controls",level:4},{value:"PII Data Analytics",id:"pii-data-analytics",level:3},{value:"1. Anonymized Analytics",id:"1-anonymized-analytics",level:4},{value:"2. Privacy-Preserving Analytics",id:"2-privacy-preserving-analytics",level:4},{value:"PII Data Monitoring",id:"pii-data-monitoring",level:3},{value:"1. Access Monitoring",id:"1-access-monitoring",level:4},{value:"2. Data Quality Monitoring",id:"2-data-quality-monitoring",level:4},{value:"PII Data Backup and Recovery",id:"pii-data-backup-and-recovery",level:3},{value:"1. Secure Backup",id:"1-secure-backup",level:4},{value:"2. Disaster Recovery",id:"2-disaster-recovery",level:4},{value:"PII Data Integration Considerations",id:"pii-data-integration-considerations",level:3},{value:"1. External System Integration",id:"1-external-system-integration",level:4},{value:"2. Third-Party Services",id:"2-third-party-services",level:4},{value:"Best Practices for PII Data Handling",id:"best-practices-for-pii-data-handling",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Environment Variables",id:"environment-variables",level:3},{value:"Dependencies",id:"dependencies",level:3},{value:"Security Features",id:"security-features",level:2},{value:"Error Handling",id:"error-handling",level:2},{value:"Performance Optimizations",id:"performance-optimizations",level:2},{value:"Integration Points",id:"integration-points",level:2}];function o(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"beneficiary-management-microservice",children:"Beneficiary Management Microservice"})}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(n.p,{children:"The Beneficiary Management microservice is a dedicated service within the Rahat platform that handles all beneficiary-related CRUD operations. It operates as a microservice using Redis for inter-service communication and provides comprehensive beneficiary management capabilities."}),"\n",(0,s.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,s.jsx)(n.h3,{id:"service-type",children:"Service Type"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Microservice"}),": Built using NestJS microservices with Redis transport"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Communication"}),": Uses Redis for inter-service communication via message patterns"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Database"}),": Uses Prisma ORM with PostgreSQL"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Queue Processing"}),": Integrates with Bull queues for background job processing"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Event-Driven"}),": Uses EventEmitter for internal event handling"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"key-components",children:"Key Components"}),"\n",(0,s.jsxs)(n.h4,{id:"1-main-application-maints",children:["1. Main Application (",(0,s.jsx)(n.code,{children:"main.ts"}),")"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Microservice configuration with Redis transport\nconst app = await NestFactory.createMicroservice<MicroserviceOptions>(\n  AppModule,\n  {\n    transport: Transport.REDIS,\n    options: {\n      host: configService.get('REDIS_HOST'),\n      port: configService.get('REDIS_PORT'),\n      password: configService.get('REDIS_PASSWORD'),\n      retryAttempts: 20,\n      retryDelay: 3000,\n    },\n  }\n);\n"})}),"\n",(0,s.jsx)(n.h4,{id:"2-core-modules",children:"2. Core Modules"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"BeneficiaryModule"}),": Main business logic for beneficiary operations"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"ListenersModule"}),": Event listeners for beneficiary-related events"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"ProcessorsModule"}),": Background job processors"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"SettingsModule"}),": Configuration management"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"crud-operations",children:"CRUD Operations"}),"\n",(0,s.jsx)(n.h3,{id:"1-create-operations",children:"1. Create Operations"}),"\n",(0,s.jsx)(n.h4,{id:"single-beneficiary-creation",children:"Single Beneficiary Creation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"@MessagePattern({ cmd: BeneficiaryJobs.CREATE })\nasync create(@Payload() createBeneficiaryDto: CreateBeneficiaryDto)\n"})}),"\n",(0,s.jsx)(n.h4,{id:"bulk-beneficiary-creation",children:"Bulk Beneficiary Creation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"@MessagePattern({ cmd: BeneficiaryJobs.CREATE_BULK })\ncreateBulk(@Payload() data)\n\n@MessagePattern({ cmd: BeneficiaryJobs.IMPORT_BENEFICIARY_LARGE_QUEUE })\ncreateBulkWithQueue(@Payload() queueData)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2-read-operations",children:"2. Read Operations"}),"\n",(0,s.jsx)(n.h4,{id:"individual-beneficiary-retrieval",children:"Individual Beneficiary Retrieval"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"@MessagePattern({ cmd: BeneficiaryJobs.GET })\nasync getBeneficiary(uuid: UUID)\n\n@MessagePattern({ cmd: BeneficiaryJobs.GET_BY_WALLET })\nasync getBeneficiaryByWallet(wallet: string)\n\n@MessagePattern({ cmd: BeneficiaryJobs.GET_BY_PHONE })\nasync getBeneficiaryByPhone(phone: string)\n"})}),"\n",(0,s.jsx)(n.h4,{id:"bulk-beneficiary-retrieval",children:"Bulk Beneficiary Retrieval"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"@MessagePattern({ cmd: BeneficiaryJobs.GET_BULK_BY_WALLET })\nasync getBulkBeneficiaryByWallet(wallet: string[])\n\n@MessagePattern({ cmd: BeneficiaryJobs.FIND_PHONE_BY_UUID })\nasync findPhoneByUUID(uuid: UUID[])\n"})}),"\n",(0,s.jsx)(n.h4,{id:"listing-and-filtering",children:"Listing and Filtering"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"@MessagePattern({ cmd: BeneficiaryJobs.LIST })\nasync list(dto: ListBeneficiaryDto)\n\n@MessagePattern({ cmd: BeneficiaryJobs.LIST_BY_PROJECT })\nasync listByProject(data: any)\n\n@MessagePattern({ cmd: BeneficiaryJobs.LIST_PII })\nasync listPiiData(dto: any)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"3-update-operations",children:"3. Update Operations"}),"\n",(0,s.jsx)(n.h4,{id:"beneficiary-updates",children:"Beneficiary Updates"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"@MessagePattern({ cmd: BeneficiaryJobs.UPDATE })\nupdate(@Param('uuid') uuid: UUID, @Payload() dto: UpdateBeneficiaryDto)\n"})}),"\n",(0,s.jsx)(n.h4,{id:"group-updates",children:"Group Updates"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"@MessagePattern({ cmd: BeneficiaryJobs.UPDATE_GROUP })\nupdateGroup(@Param('uuid') uuid: UUID, @Payload() dto: UpdateBeneficiaryGroupDto)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"4-delete-operations",children:"4. Delete Operations"}),"\n",(0,s.jsx)(n.h4,{id:"beneficiary-deletion",children:"Beneficiary Deletion"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"@MessagePattern({ cmd: BeneficiaryJobs.DELETE })\ndelete(payload: any)\n\n@MessagePattern({ cmd: BeneficiaryJobs.REMOVE })\nasync remove(payload: any)\n\n@MessagePattern({ cmd: BeneficiaryJobs.DELETE_BENEFICIARY_AND_PII })\nasync deleteBenefAndPii(payload: any)\n"})}),"\n",(0,s.jsx)(n.h4,{id:"group-deletion",children:"Group Deletion"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"@MessagePattern({ cmd: BeneficiaryJobs.REMOVE_ONE_GROUP })\nremoveGroup(uuid: string)\n\n@MessagePattern({ cmd: BeneficiaryJobs.DELETE_ONE_GROUP })\ndeleteGroup(uuid: string)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"project-management",children:"Project Management"}),"\n",(0,s.jsx)(n.h3,{id:"adding-beneficiaries-to-projects",children:"Adding Beneficiaries to Projects"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"@MessagePattern({ cmd: BeneficiaryJobs.ADD_TO_PROJECT })\nasync addToProject(payload: any)\n\n@MessagePattern({ cmd: BeneficiaryJobs.BULK_ADD_TO_PROJECT })\nasync bulkaddToProject(payload: addBulkBeneficiaryToProject)\n\n@MessagePattern({ cmd: BeneficiaryJobs.ASSIGN_TO_PROJECT })\nasync assignToProject(payload: any)\n\n@MessagePattern({ cmd: BeneficiaryJobs.BULK_ASSIGN_TO_PROJECT })\nasync bulkAssignToProject(payload: any)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"group-management",children:"Group Management"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"@MessagePattern({ cmd: BeneficiaryJobs.ADD_GROUP })\naddGroup(payload: CreateBeneficiaryGroupsDto)\n\n@MessagePattern({ cmd: BeneficiaryJobs.GET_ALL_GROUPS })\ngetAllGroups(dto: ListBeneficiaryGroupDto)\n\n@MessagePattern({ cmd: BeneficiaryJobs.ASSIGN_GROUP_TO_PROJECT })\nasync assignGroupToProject(payload: any)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"verification-and-security",children:"Verification and Security"}),"\n",(0,s.jsx)(n.h3,{id:"wallet-validation",children:"Wallet Validation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"@MessagePattern({ cmd: BeneficiaryJobs.VALIDATE_WALLET })\nvalidateWallet(validationData: ValidateWallet)\n\n@MessagePattern({ cmd: BeneficiaryJobs.VERIFY_SIGNATURE })\nverifySignature(verificationData: any)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"link-generation",children:"Link Generation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"@MessagePattern({ cmd: BeneficiaryJobs.GENERATE_LINK })\ngenerateLink(uuid: UUID)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"statistics-and-analytics",children:"Statistics and Analytics"}),"\n",(0,s.jsx)(n.h3,{id:"general-statistics",children:"General Statistics"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"@MessagePattern({ cmd: BeneficiaryJobs.STATS })\nasync stats()\n\n@MessagePattern({ cmd: BeneficiaryJobs.GET_TABLE_STATS })\ngetTableStats()\n\n@MessagePattern({ cmd: BeneficiaryJobs.GET_ALL_STATS })\nasync getAllStats()\n"})}),"\n",(0,s.jsx)(n.h3,{id:"project-specific-statistics",children:"Project-Specific Statistics"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"@MessagePattern({ cmd: BeneficiaryJobs.PROJECT_STATS })\nasync projectStats(uuid: string)\n\n@MessagePattern({ cmd: BeneficiaryJobs.GET_STATS })\nasync getProjectStats(data: any)\n\n@MessagePattern({ cmd: BeneficiaryJobs.CALCULATE_STATS })\nasync syncProjectStats(payload)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"import-and-export-features",children:"Import and Export Features"}),"\n",(0,s.jsx)(n.h3,{id:"temporary-beneficiary-management",children:"Temporary Beneficiary Management"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"@MessagePattern({ cmd: BeneficiaryJobs.LIST_TEMP_BENEFICIARY })\nasync listTempBeneficiaries(data: any)\n\n@MessagePattern({ cmd: BeneficiaryJobs.LIST_TEMP_GROUPS })\nasync listTempGroups(query: ListTempGroupsDto)\n\n@MessagePattern({ cmd: BeneficiaryJobs.IMPORT_TEMP_BENEFICIARIES })\nasync importTempBeneficiary(data: ImportTempBenefDto)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"community-tool-integration",children:"Community Tool Integration"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"@MessagePattern({ cmd: BeneficiaryJobs.IMPORT_BENEFICIARIES_FROM_COMMUNITY_TOOL })\nasync importBeneficiariesFromTool(data: any)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"background-processing",children:"Background Processing"}),"\n",(0,s.jsx)(n.h3,{id:"queue-management",children:"Queue Management"}),"\n",(0,s.jsx)(n.p,{children:"The service integrates with Bull queues for handling large-scale operations:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"RAHAT_BENEFICIARY"}),": Main queue for beneficiary operations"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Batch Processing"}),": Handles bulk operations with configurable batch sizes"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Error Handling"}),": Comprehensive error handling with retry mechanisms"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"processors",children:"Processors"}),"\n",(0,s.jsxs)(n.p,{children:["Located in ",(0,s.jsx)(n.code,{children:"src/processors/"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"beneficiary.processor.ts"}),": Handles background beneficiary processing"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"processor.utils.ts"}),": Utility functions for processing operations"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"consumers",children:"Consumers"}),"\n",(0,s.jsxs)(n.p,{children:["Located in ",(0,s.jsx)(n.code,{children:"src/consumers/"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"beneficiary.consumer.ts"}),": Main consumer for beneficiary operations"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"target.export.rabbitmq.worker.ts"}),": Handles target export operations"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"data-models",children:"Data Models"}),"\n",(0,s.jsx)(n.h3,{id:"core-entities",children:"Core Entities"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Beneficiary"}),": Main beneficiary entity with PII separation"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"BeneficiaryPii"}),": Personal Identifiable Information"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"BeneficiaryProject"}),": Project assignments"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"BeneficiaryGroups"}),": Group management"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"GroupPurpose"}),": Group purpose definitions"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"pii-handling",children:"PII Handling"}),"\n",(0,s.jsx)(n.p,{children:"The service implements PII (Personal Identifiable Information) separation:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Sensitive data is stored separately in ",(0,s.jsx)(n.code,{children:"BeneficiaryPii"})," table"]}),"\n",(0,s.jsxs)(n.li,{children:["Non-PII data is stored in the main ",(0,s.jsx)(n.code,{children:"Beneficiary"})," table"]}),"\n",(0,s.jsx)(n.li,{children:"Data sanitization utilities are provided"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"pii-data-considerations",children:"PII Data Considerations"}),"\n",(0,s.jsx)(n.h3,{id:"pii-data-architecture",children:"PII Data Architecture"}),"\n",(0,s.jsx)(n.h4,{id:"data-separation-strategy",children:"Data Separation Strategy"}),"\n",(0,s.jsx)(n.p,{children:"The beneficiary microservice implements a robust PII data separation strategy:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// PII data structure\ninterface BeneficiaryPii {\n  uuid: string;\n  beneficiaryId: string;\n  name: string;           // Full name\n  phone: string;          // Phone number\n  email: string;          // Email address\n  extras: {\n    govtIDNumber: string; // Government ID\n    // Other sensitive fields\n  };\n  createdAt: Date;\n  updatedAt: Date;\n}\n\n// Non-PII data structure\ninterface Beneficiary {\n  uuid: string;\n  walletAddress: string;\n  age: number;\n  gender: string;\n  type: string;\n  isVerified: boolean;\n  // Other non-sensitive fields\n}\n"})}),"\n",(0,s.jsx)(n.h4,{id:"pii-data-processing-utilities",children:"PII Data Processing Utilities"}),"\n",(0,s.jsx)(n.p,{children:"The service provides specialized utilities for PII handling:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// From helpers/index.ts\nexport const splitBeneficiaryPII = (beneficiary: any) => {\n  const { firstName, lastName, phone, email, govtIDNumber, archived, deletedAt, ...rest } = beneficiary;\n  const piiData = {\n    name: `${beneficiary.firstName} ${beneficiary.lastName}`,\n    phone: phone || '',\n    email: email || '',\n    extras: {\n      govtIDNumber: govtIDNumber || ''\n    }\n  }\n  const sanitized = sanitizeBeneficiaryPayload(rest);\n  return { piiData, nonPii: sanitized }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"pii-data-security-measures",children:"PII Data Security Measures"}),"\n",(0,s.jsx)(n.h4,{id:"1-encryption-at-rest",children:"1. Encryption at Rest"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"AES-256-CBC Encryption"}),": PII data is encrypted using AES-256-CBC"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Key Management"}),": Private keys are managed through environment variables"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"IV Handling"}),": Unique initialization vectors for each encryption operation"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// From verification.service.ts\nprivate readonly algorithm = 'aes-256-cbc'\nprivate readonly privateKey = this.configService.get('PRIVATE_KEY')\nprivate iv = Buffer.from('0123456789ABCDEF0123456789ABCDEF', 'hex')\n\nencrypt(data) {\n    const cipher = crypto.createCipheriv('aes-256-cbc', Buffer.from(this.getSecret()), this.iv);\n    let encryptedData = cipher.update(data, 'utf8', 'hex');\n    encryptedData += cipher.final('hex');\n    return encryptedData;\n}\n"})}),"\n",(0,s.jsx)(n.h4,{id:"2-data-access-controls",children:"2. Data Access Controls"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Role-Based Access"}),": Different access levels for PII vs non-PII data"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Audit Logging"}),": All PII data access is logged for compliance"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Time-Limited Access"}),": Temporary access tokens for PII data retrieval"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"3-data-minimization",children:"3. Data Minimization"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Selective Exposure"}),": Only necessary PII fields are exposed in responses"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Field-Level Encryption"}),": Individual sensitive fields can be encrypted separately"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Anonymization"}),": PII data can be anonymized for analytics purposes"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"pii-data-operations",children:"PII Data Operations"}),"\n",(0,s.jsx)(n.h4,{id:"1-pii-specific-crud-operations",children:"1. PII-Specific CRUD Operations"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// PII data retrieval with encryption\n@MessagePattern({ cmd: BeneficiaryJobs.LIST_PII })\nasync listPiiData(dto: any) {\n  // Returns encrypted PII data with access controls\n  return this.service.listPiiData(dto);\n}\n\n// PII data update with validation\nasync updatePIIByBenefUUID(benefUUID: UUID, piiData: TPIIData) {\n  // Validates and encrypts PII data before storage\n  return this.prisma.beneficiaryPii.update({\n    where: { beneficiaryId: benefUUID },\n    data: piiData\n  });\n}\n\n// PII data deletion with cleanup\nasync deletePIIByBenefUUID(benefUUID: UUID) {\n  // Securely removes PII data with audit trail\n  return this.prisma.beneficiaryPii.delete({\n    where: { beneficiaryId: benefUUID }\n  });\n}\n"})}),"\n",(0,s.jsx)(n.h4,{id:"2-pii-data-validation",children:"2. PII Data Validation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// PII data validation utilities\nconst validatePIIData = (piiData: any) => {\n  const requiredFields = ['name', 'phone'];\n  const missingFields = requiredFields.filter(field => !piiData[field]);\n  \n  if (missingFields.length > 0) {\n    throw new Error(`Missing required PII fields: ${missingFields.join(', ')}`);\n  }\n  \n  // Validate phone number format\n  if (piiData.phone && !isValidPhoneNumber(piiData.phone)) {\n    throw new Error('Invalid phone number format');\n  }\n  \n  // Validate email format\n  if (piiData.email && !isValidEmail(piiData.email)) {\n    throw new Error('Invalid email format');\n  }\n  \n  return true;\n};\n"})}),"\n",(0,s.jsx)(n.h3,{id:"pii-data-compliance",children:"PII Data Compliance"}),"\n",(0,s.jsx)(n.h4,{id:"1-gdpr-compliance",children:"1. GDPR Compliance"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Right to be Forgotten"}),": Complete PII data deletion capability"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Data Portability"}),": Export PII data in standard formats"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Consent Management"}),": Track and manage PII data consent"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Data Retention"}),": Configurable retention policies for PII data"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"2-data-privacy-controls",children:"2. Data Privacy Controls"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Consent Tracking"}),": Monitor user consent for PII data processing"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Purpose Limitation"}),": Restrict PII data usage to specific purposes"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Data Subject Rights"}),": Support for data subject access requests"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// GDPR compliance utilities\nasync handleDataSubjectRequest(beneficiaryId: string, requestType: 'access' | 'deletion' | 'portability') {\n  switch (requestType) {\n    case 'access':\n      return this.getPIIDataForSubject(beneficiaryId);\n    case 'deletion':\n      return this.deletePIIDataForSubject(beneficiaryId);\n    case 'portability':\n      return this.exportPIIDataForSubject(beneficiaryId);\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"pii-data-analytics",children:"PII Data Analytics"}),"\n",(0,s.jsx)(n.h4,{id:"1-anonymized-analytics",children:"1. Anonymized Analytics"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Aggregated Statistics"}),": PII data is aggregated for analytics"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Pseudonymization"}),": Personal identifiers are replaced with pseudonyms"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Statistical Analysis"}),": Safe statistical analysis without individual identification"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Anonymized statistics generation\nasync generateAnonymizedStats(projectId: string) {\n  const stats = await this.prisma.beneficiary.groupBy({\n    by: ['age', 'gender'],\n    _count: { uuid: true },\n    where: { \n      projects: { some: { projectId } }\n    }\n  });\n  \n  return stats.map(stat => ({\n    ageGroup: stat.age,\n    gender: stat.gender,\n    count: stat._count.uuid\n  }));\n}\n"})}),"\n",(0,s.jsx)(n.h4,{id:"2-privacy-preserving-analytics",children:"2. Privacy-Preserving Analytics"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Differential Privacy"}),": Statistical noise addition for privacy protection"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"K-Anonymity"}),": Ensuring at least K individuals share the same attributes"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Data Masking"}),": Sensitive data masking for analytics"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"pii-data-monitoring",children:"PII Data Monitoring"}),"\n",(0,s.jsx)(n.h4,{id:"1-access-monitoring",children:"1. Access Monitoring"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Access Logs"}),": Track all PII data access attempts"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Anomaly Detection"}),": Detect unusual access patterns"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Alert System"}),": Notify administrators of suspicious activities"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"2-data-quality-monitoring",children:"2. Data Quality Monitoring"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Data Completeness"}),": Monitor PII data completeness rates"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Data Accuracy"}),": Validate PII data accuracy"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Data Freshness"}),": Track PII data update frequency"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"pii-data-backup-and-recovery",children:"PII Data Backup and Recovery"}),"\n",(0,s.jsx)(n.h4,{id:"1-secure-backup",children:"1. Secure Backup"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Encrypted Backups"}),": All PII data backups are encrypted"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Geographic Distribution"}),": Backups stored in multiple locations"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Access Controls"}),": Strict access controls for backup data"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"2-disaster-recovery",children:"2. Disaster Recovery"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Recovery Procedures"}),": Documented procedures for PII data recovery"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Testing"}),": Regular testing of PII data recovery procedures"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Compliance"}),": Recovery procedures comply with data protection regulations"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"pii-data-integration-considerations",children:"PII Data Integration Considerations"}),"\n",(0,s.jsx)(n.h4,{id:"1-external-system-integration",children:"1. External System Integration"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"API Security"}),": Secure APIs for PII data exchange"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Data Mapping"}),": Clear mapping of PII data fields"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Consent Propagation"}),": Propagate consent across integrated systems"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"2-third-party-services",children:"2. Third-Party Services"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Vendor Assessment"}),": Assess third-party PII data handling"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Data Processing Agreements"}),": Clear agreements for PII data processing"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Audit Rights"}),": Right to audit third-party PII data handling"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"best-practices-for-pii-data-handling",children:"Best Practices for PII Data Handling"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Minimize Collection"}),": Only collect necessary PII data"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Secure Storage"}),": Use encryption for PII data at rest and in transit"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Access Control"}),": Implement strict access controls for PII data"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Regular Audits"}),": Conduct regular PII data handling audits"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Staff Training"}),": Train staff on PII data handling procedures"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Incident Response"}),": Have procedures for PII data breaches"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Compliance Monitoring"}),": Regular compliance monitoring and updates"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,s.jsx)(n.h3,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"PORT_BEN"}),": Service port"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"REDIS_HOST"}),": Redis host for microservice communication"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"REDIS_PORT"}),": Redis port"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"REDIS_PASSWORD"}),": Redis password"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"RABBIT_MQ_URL"}),": RabbitMQ connection URL"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"SMTP_*"}),": Email configuration for notifications"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"dependencies",children:"Dependencies"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"@rahataid/sdk"}),": Core SDK with job definitions and constants"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"@rumsan/prisma"}),": Database ORM"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"@rumsan/extensions"}),": Extension utilities"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"@rahat/stats"}),": Statistics module"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Bull"}),": Queue processing"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"EventEmitter"}),": Event handling"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"security-features",children:"Security Features"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"PII Separation"}),": Sensitive data is stored separately"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Data Sanitization"}),": Input data is sanitized before processing"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Wallet Validation"}),": Cryptographic wallet validation"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Signature Verification"}),": Digital signature verification"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Access Control"}),": Role-based access control through guards"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"RpcExceptionFilter"}),": Global exception filter for microservice errors"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Retry Mechanisms"}),": Configurable retry attempts for failed operations"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Validation"}),": Comprehensive input validation"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Logging"}),": Structured logging for debugging and monitoring"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"performance-optimizations",children:"Performance Optimizations"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Batch Processing"}),": Large operations are processed in batches"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Queue Management"}),": Background processing for heavy operations"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Database Optimization"}),": Efficient queries with proper indexing"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Caching"}),": Redis-based caching for frequently accessed data"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"integration-points",children:"Integration Points"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Wallet Service"}),": For wallet address validation and management"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Project Service"}),": For project-related operations"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Statistics Service"}),": For analytics and reporting"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Email Service"}),": For notifications and communications"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Community Tools"}),": For beneficiary import/export operations"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"This microservice provides a comprehensive solution for beneficiary management with robust CRUD operations, security features, and scalability considerations."})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>c});var a=i(96540);const s={},r=a.createContext(s);function t(e){const n=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);